{
    order veil_handler before reverse_proxy
    admin 0.0.0.0:2019
    auto_https off  # Disable HTTPS for testing
    debug
}

:2020 {
    log {
        output stderr
        format console
        level DEBUG
    }

    # Global Veil Handler Configuration
    veil_handler {
        database test.db
        header X-Subscription-Key
    }

    # Proxy API requests to appropriate backend services
    handle /api/v1/users/* {
        reverse_proxy http://localhost:8080
    }

    handle /api/v1/products/* {
        reverse_proxy http://localhost:8081
    }

    handle /api/v1/orders/* {
        reverse_proxy http://localhost:8082
    }

    # Proxy Veil Management APIs back to Caddy (since Veil is a module)
    handle /veil/api/* {
        reverse_proxy http://localhost:2020
    }
}