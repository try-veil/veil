{
  "admin": {
    "listen": "0.0.0.0:2019"
  },
  "apps": {
    "http": {
      "servers": {
        "srv0": {
          "automatic_https": {
            "disable": true
          },
          "listen": [
            ":2020"
          ],
          "logs": {
            "default_logger_name": "log0"
          },
          "routes": [
            {
              "group": "group4",
              "handle": [
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "db_path": "./veil.db",
                          "handler": "veil_handler",
                          "subscription_key": "X-Subscription-Key"
                        },
                        {
                          "handler": "reverse_proxy",
                          "upstreams": [
                            {
                              "dial": "localhost:8081"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ],
              "match": [
                {
                  "path": [
                    "/api/v1/products/*"
                  ]
                }
              ]
            },
            {
              "group": "group4",
              "handle": [
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "db_path": "./veil.db",
                          "handler": "veil_handler",
                          "subscription_key": "X-Subscription-Key"
                        },
                        {
                          "handler": "reverse_proxy",
                          "upstreams": [
                            {
                              "dial": "localhost:8082"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ],
              "match": [
                {
                  "path": [
                    "/api/v1/orders/*"
                  ]
                }
              ]
            },
            {
              "group": "group4",
              "handle": [
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "db_path": "./veil.db",
                          "handler": "veil_handler",
                          "subscription_key": "X-Subscription-Key"
                        },
                        {
                          "handler": "reverse_proxy",
                          "upstreams": [
                            {
                              "dial": "localhost:8080"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ],
              "match": [
                {
                  "path": [
                    "/api/v1/users/*"
                  ]
                }
              ]
            },
            {
              "group": "group4",
              "handle": [
                {
                  "db_path": "./veil.db",
                  "handler": "veil_handler",
                  "subscription_key": "X-Subscription-Key"
                },
                {
                  "handler": "reverse_proxy",
                  "upstreams": [
                    {
                      "dial": "localhost:8081"
                    }
                  ]
                }
              ],
              "match": [
                {
                  "path": [
                    "/api/v1/echo/*"
                  ]
                }
              ]
            },
            {
              "group": "group4",
              "handle": [
                {
                  "handler": "subroute",
                  "routes": [
                    {
                      "handle": [
                        {
                          "handler": "rewrite",
                          "strip_path_prefix": "/veil/api"
                        }
                      ]
                    },
                    {
                      "handle": [
                        {
                          "handler": "reverse_proxy",
                          "upstreams": [
                            {
                              "dial": "localhost:2020"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ],
              "match": [
                {
                  "path": [
                    "/veil/api/*"
                  ]
                }
              ]
            }
          ]
        }
      }
    }
  },
  "logging": {
    "logs": {
      "default": {
        "exclude": [
          "http.log.access.log0"
        ],
        "level": "DEBUG"
      },
      "log0": {
        "encoder": {
          "format": "console"
        },
        "include": [
          "http.log.access.log0"
        ],
        "level": "DEBUG",
        "writer": {
          "output": "stderr"
        }
      }
    }
  }
}